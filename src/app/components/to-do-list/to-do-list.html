<div class="container" [class.container-open]="(selectedItemId$ | async) !== null">
    <div class="header">
        <h1>Todo List</h1>
    </div>
    @if (isLoading$ | async) {
        <tui-loader [inheritColor]="true" />
    } @else {
        <div class="list">
            <div #bodyList [class.list-body]="(selectedItemId$ | async) !== null">
                <div class="body">
                    @if ((list$ | async)?.length) {
                        <ul>
                            @for (item of list$ | async; track item.id) {
                                <li>
                                    <to-do-list-item 
                                        [class.selected]="(selectedItemId$ | async) === item.id"
                                        [item]="item"
                                        [isEdit]="(selectedItemId$ | async) === item.id && !!(isEdit$ | async)"
                                        (deleteItemEvent)="deleteItem($event)"
                                        (selectItemEvent)="selectItem($event)"
                                        (editItemEvent)="editItem($event)"
                                        (saveItemEvent)="saveItem($event, descriptionNewValue)"
                                    />
                                </li>
                            }
                        </ul>
                    } @else {
                        <p>Здесь может быть ваш список дел!</p>
                    }
                </div>
                <div class="footer">
                    <tui-textfield class="input" tuiTextfieldSize="m" [tuiTextfieldCleaner]="true">
                        <label tuiLabel>Новое дело:</label>
                        <input
                            tuiTextfield
                            placeholder="Введите новое дело..."
                            [(ngModel)]="textValue"
                        />
                    </tui-textfield>
                    <tui-expand [expanded]="!!textValue.length">
                        <tui-textfield class="textarea" tuiTextfieldSize="m" [tuiTextfieldCleaner]="true">
                            <label tuiLabel>Описание:</label>
                            <textarea
                                tuiTextarea
                                placeholder="Введите описание нового дела..."
                                [(ngModel)]="descriptionValue"
                            ></textarea>
                        </tui-textfield>
                    </tui-expand>
                    <ui-button
                        tooltip
                        tooltipText="Нажмите, чтобы добавить"
                        tooltipPos="bottom"
                        class="button button-add"
                        [class.disabled]="!textValue.length"
                        title="Добавить"
                        (outClickEmitter)="addItem({text: textValue, description: descriptionValue})"
                    />
                </div>
            </div>
            <tui-expand [expanded]="(selectedItemId$ | async) !== null">
                <div class="list-description" [class.edited]="isEdit$ | async" [ngStyle]="{'height.px': height}">
                    @if ((isEdit$ | async) === false) {
                        <tui-scrollbar>
                            <span [style]="{fontWeight: 600}">Описание:</span><br>
                            <span>{{ editedDescription$ | async }}</span>
                        </tui-scrollbar>
                    } @else {
                        <tui-textfield class="textarea-edit" tuiTextfieldSize="m" [tuiTextfieldCleaner]="false">
                            <label tuiLabel>Описание:</label>
                            <textarea
                                tuiTextarea
                                placeholder="Введите новое описание дела..."
                                [(ngModel)]="descriptionNewValue"
                            ></textarea>
                        </tui-textfield>
                    }

                </div>
            </tui-expand>
        </div>
    }
</div>

